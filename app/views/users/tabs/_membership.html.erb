<div class="tab-pane fade" id="admin-membership" role="tabpanel" aria-labelledby="admin-membership-tab">
  <div class="row">
    <%= form_tag admin_create_membership_memberships_path, method: :post, class: 'row' do %>
      <%= hidden_field_tag :user_id, @repo_user.id %>

      <div class="col-md-4">
        <label for="extend_days" class="form-label">Create or Renew Membership</label>
        <%= number_field_tag :extend_days, nil, min: 1, class: 'form-control', id: 'extend_days', required: true, placeholder: 'Enter number of days' %>
      </div>

      <div class="col-md-2 d-flex align-items-end">
        <%= submit_tag 'Add Membership', class: 'btn btn-primary' %>
      </div>
    <% end %>
  </div>

  <% memberships = @repo_user.memberships.where(status: ['paid', 'revoked']).order(created_at: :desc) %>
 
  <% if memberships.any? %>
    <div class="row mt-4">
      <div class="col-12">
        <h4>History</h4>
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col" class="w-40 text-start"><%= t('memberships.index.history.type') %></th>
                <th scope="col" class="w-20 text-start"><%= t('memberships.index.history.purchase_date') %></th>
                <th scope="col" class="w-20 text-start"><%= t('memberships.index.history.expiry_date') %></th>
                <th scope="col" class="w-20 text-start"><%= t('memberships.index.history.status') %></th>
                <th scope="col" class="w-20 text-start">Delete</th>
              </tr>
            </thead>
            <tbody>
              <% memberships.each do |membership| %>
                <tr>
                  <td class="text-start">
                    <%= membership.membership_title.gsub(/\b(Membership|Adhésion)\b/i, '').strip %>
                  </td>
                  <td class="text-start">
                    <%= membership.created_at.to_formatted_s(:long) %>
                  </td>
                  <td class="text-start">
                    <%= membership.end_date&.to_date&.to_formatted_s(:long) || '—' %>
                  </td>
                  <td class="text-start">
                    <% if membership.active? %>
                      <span class="badge bg-success"><%= t('memberships.index.history.active') %></span>
                    <% elsif membership.status == 'revoked' %>
                      <span class="badge bg-secondary"><%= t('memberships.index.history.revoked') %></span>
                    <% else %>
                      <span class="badge bg-secondary"><%= t('memberships.index.history.expired') %></span>
                    <% end %>
                  </td>
                  <td class="text-start">
                    <% unless membership.status == 'revoked' || membership.membership_tier == 'faculty' %>
                      <%= button_to revoke_membership_path(membership),
                                    method: :patch,
                                    class: "btn btn-sm btn-outline-danger ms-2",
                                    data: { confirm: "Are you sure you want to revoke this membership?" } do %>
                        ✖
                      <% end %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% else %>
    <div class="alert alert-warning mt-4" role="alert">
        <%= t('memberships.index.no_history') %>
    </div>
  <% end %>
</div>