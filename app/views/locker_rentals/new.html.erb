<% provide :title, 'Request a locker' %>

<div class="container">
    <h1 class="text-center pt-3"><%= t('lockers.new_request.header') %></h1>
    <hr class="w-50 mx-auto" />
    <%= t('lockers.new_request.description_html') %>
    <hr />
    <% if !LockerOption.lockers_enabled %>
        Locker requests are not currently accepted.
    <% elsif @pending_locker_request&.reviewing? %>
        <p>You have a pending request for a locker submitted on <b><%= @pending_locker_request.created_at.to_date %></b>.
            You will receive a response shortly.</p>
    <% elsif @pending_locker_request&.await_payment? %>
        <p>Your request has been accepted, and now is pending payment to be finalized. <%= link_to 'Click here to view your request and to proceed to checkout', @pending_locker_request, class: '' %></p>
    <% else %>
        <%= form_with model: @locker_rental do |f| %>
            <div class="row row-cols-auto mb-3">
                <div>
                    <%= f.label :requested_as, 'I am a ', class: 'form-label' %>
                    <%= f.select :requested_as, options_for_select(@available_fors), {}, { class: 'form-select w-auto', required: true } %>
                </div>
                <div>
                    <%= f.label :preferred_locker, 'You can request for a locker, if it is available', class: 'form-label' %>
                    <%= f.collection_select :preferred_locker, Locker.available, :id, :specifier, {}, {class: 'form-select'} %>
                    <div class="form-text">Locker location is dependent on availability.</div>
                </div>
            </div>
            <fieldset id="repo-select" class="border rounded px-3" hidden disabled>
                <p class="mb-3">If applying as a GNG student, please provide a link to your repository page here to help speed up your application</p>
                <%= f.select :repository_id, options_for_select(@user_repositories),
                 {prompt: @user_repositories.empty? ? 'No repositories are linked to your account' : 'Select a repository'},
                 {class: 'form-select mb-3', disabled: @user_repositories.empty? } %>
                <div class="row">
                    <div class="col">
                        <%= f.label :course_name_id, 'What course are you enrolled in?' %>
                        <%= f.collection_select :course_name_id, CourseName.all, :id, :name, {}, {class: 'form-select'} %>
                    </div>
                    <div class="col">
                        <%= f.label :section_name, "What section are you in?" %>
                        <%= f.text_field :section_name, class: 'form-control', required: true %>
                    </div>
                    <div class="col">
                        <%= f.label :team_name, 'What is your team name?', class: 'form-label' %>
                        <%= f.text_field :team_name, class: 'form-control', required: true %>
                    </div>
                </div>
            </fieldset>
            <%= f.label :notes, 'Notes with request:' %>
            <%= f.text_area :notes, class: 'form-control mb-3' %>
            <div class="d-flex justify-content-between mb-3">
                <%= f.submit 'Submit request', class: 'btn btn-primary' %>
                <%= link_to "Back", locker_rentals_path, class: 'btn btn-secondary' %>
            </div>

        <% end %>
    <% end %>

    <% if @locker_rental.errors.any? %>
        <div class="border">
            <p class="fw-bold">Errors:</p>
            <ul>
                <% @locker_rental.errors.each do |error| %>
                    <li><%= error.full_message %></li>
                <% end %>
            </ul>
        </div>
    <% end %>
</div>
