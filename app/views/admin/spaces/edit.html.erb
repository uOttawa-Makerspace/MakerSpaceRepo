<section>
  <h2 class="fw-bold text-center py-3"><%= link_to "Spaces' Manager", admin_spaces_path %></h2><br></br>
  <h1 style="font-weight:bold;text-align:center;"><%= @space.name.upcase %></h1><br>

  <h4>Max Capacity</h4>

  <div class="mb-3">
    <%= form_for update_max_capacity_admin_spaces_path, url: { controller: "admin/spaces", action: "update_max_capacity" }, method: :post do |f| %>
      <%= label_tag(:max_capacity, "Maximum Capacity", class:"form-label") %>
      <%= number_field_tag :max_capacity, @space.max_capacity, { class: "form-control" } %>
      <%= hidden_field_tag :space_id, @space.id %> <br>
      <%= f.submit "Update Max Capacity", class: "btn btn-primary", data: { confirm: 'Are your sure you want to update the maximum capacity of the space ?' } %>
    <% end %>
  </div>

  <br><br>

  <h4>Staff needed</h4>

  <div class="responsive-table">
    <table class="table  table-striped">
      <thead class="table-primary">
      <tr>
        <th scope="col">Day</th>
        <th scope="col">Start Time</th>
        <th scope="col">End Time</th>
        <th scope="col">Action</th>
      </tr>
      </thead>
      <tbody>
      <% @space.space_staff_hour.order(:day, :start_time).each do |needed_staff| %>
        <tr>
          <td><%= needed_staff.week_day %></td>
          <td><%= needed_staff.start_time.strftime("%H:%M")  %></td>
          <td><%= needed_staff.end_time.strftime("%H:%M")  %></td>
          <td><%=link_to "Delete", { controller: "admin/spaces", action: :delete_space_hour, space_staff_hour_id: needed_staff.id }, method: :delete,
                          data: { confirm: 'Are you sure that you want to delete this slot?' },
                          class:"btn btn-danger btn-sm d-block w-100 mb-1 me-0" %></td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>

  <div class="mb-3">
    <%= form_for add_space_hours_admin_spaces_path, url: { controller: "admin/spaces", action: "add_space_hours" }, method: :post do |f| %>
      <div class="row">
        <div class="col-md-12">
          <div class="mb-3 text-center">
            <%= label_tag :day, "Day of the week", class:"form-label" %>
            <%= select_tag :day, options_for_select(Hash[Date::DAYNAMES.zip([0, 1, 2, 3, 4, 5, 6])]), { class: "form-control form-select"} %>
          </div>
        </div>

        <div class="mb-3 col-md-6 text-center">
          <%= label_tag :start_time, 'Start Time (24h format)', class:"form-label" %>
          <div class="input-group">
            <%= text_field_tag "start_time", {}, {id: 'start_time', autocomplete: 'off', class: "form-control", required: true} %>
            <button class="btn btn-outline-danger" id="start_time_clear" type="button">
              <i class="fa fa-times"></i>
            </button>
          </div>
        </div>
        <div class="col-md-6">
          <%= label_tag :end_time, 'End Time (24h format)', class:"form-label" %>
          <div class="input-group">
            <%= text_field_tag "end_time", {}, {id: 'end_time', autocomplete: 'off', class: "form-control", required: true} %>
            <button class="btn btn-outline-danger" id="end_time_clear" type="button">
              <i class="fa fa-times"></i>
            </button>
          </div>
        </div>

        <div class="col-lg-12 text-center">
          <%= hidden_field_tag :space_id, @space.id %> <br>
          <%= f.submit "Add a new slot where staffs are needed", class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>

  <br><br>

  <table class="table table-striped">
    <th class="section-header">Manage RFID Readers</th>
  </table>
  <br>
  <div>
    <h3><%= @space.name.capitalize %> RFID Readers</h3>
    <table class="table table-striped">
      <thead class="table-primary">
      <tr>
        <th>Reader Mac Address</th>
        <th>Space</th>
        <th>Disassociate from <%= @space.name.capitalize %></th>
      </tr>
      </thead>
      <% @space.pi_readers.each do |raspi| %>
        <tr>
          <td><%= raspi.pi_mac_address %></td>
          <td><%= raspi.space.name %></td>
          <td><%= link_to fa_icon('times'), admin_pi_reader_url(id: raspi.id, pi_reader_params: { space_id: nil }), method: :patch, action: :update, path: '/' %></td>
        </tr>
      <% end %>
    </table>

    <br>

    <h3>Unassociated RFID Readers</h3>
    <table class="table table-striped">
      <thead class="table-primary">
      <tr>
        <th>Reader Mac Address</th>
        <th>Space</th>
        <th>Associate with <%= @space.name.capitalize %></th>
      </tr>
      </thead>
      <% PiReader.where(space_id: nil).each do |raspi| %>
        <tr>
          <td><%= raspi.pi_mac_address %></td>
          <td>unknown</td>
          <td><%= link_to fa_icon('check'), admin_pi_reader_url(id: raspi.id, pi_reader_params: { space_id: @space.id }), method: :patch, action: :update, path: '/' %></td>
        </tr>
      <% end %>
    </table>
  </div>

  <br>

  <table class="table table-striped">
    <th class="section-header">Manage Trainings</th>
  </table>
  <div>
    <br><br>
    <h3 style="font-weight:bold;">New <%= @space.name.capitalize %> Training:</h3>
    <%= form_for @new_training, :url => { :action => "create", controller: 'admin/trainings' } do |f| %>
      <%= f.hidden_field :space_id, value: @space.id %>
      <%= f.text_field :name, placeholder: 'Enter a unique name', class: "form-control" %>
      <div class="text-center">
        <br/>
        <%= submit_tag "Add", class: "btn btn-primary" %>
      </div>
    <% end %>
    <br>

    <h3><%= @space.name.capitalize %> Trainings</h3>
    <table class="table table-striped">
      <thead class="table-primary">
      <tr>
        <th>Training</th>
        <th>Total Sessions</th>
        <th>Total Certifications</th>
        <th>Delete Training and all Sessions and Certifications</th>
      </tr>
      </thead>
      <% @space.trainings.each do |training| %>
        <tr>
          <td><%= training.name %></td>
          <td><%= training.training_sessions.length %></td>
          <td><%= training.certifications.length %></td>
          <td><%= link_to fa_icon('times'), admin_training_url(id: training.id), method: :delete, action: :destroy,
                          data: { confirm: 'Deleting a training will delete ALL its Sessions and Certifications! Ok to confirm' } %></td>
        </tr>
      <% end %>
    </table>
  </div>

  <br></br>
  <h3>Edit space name</h3>
  New name
  <%= form_for admin_spaces_path, action: :update_name, method: :post do |f| %>
    <div class="mb-3">
      <%= text_field_tag :name, "", class: "form-control" %>
      <%= hidden_field_tag :space_id, @space.id %> <br>
      <%= f.submit "Edit name", class: "btn btn-primary", data: { confirm: 'Are your sure you want to change the name of the space ?' } %>
    </div>
  <% end %>
  <br>
  <h3>New Sub Space</h3>
  <%= form_for admin_spaces_path, action: :create_sub_space, method: :put do |f| %>
    <div class="mb-3">
      <%= text_field_tag :name, "", class: "form-control" %>
      <%= hidden_field_tag :space_id, @space.id %>
      <%= f.submit "Create new sub space", class: "btn btn-primary" %>
    </div>
  <% end %>

  <br>
  <h3>Sub Spaces</h3>
  <table class="table table-striped">
    <thead class="table-primary">
    <tr>
      <th>Sub Space</th>
      <th>Delete Sub Space</th>
    </tr>
    </thead>
    <% SubSpace.where(space: @space).each do |sub_space| %>
      <tr>
        <td><%= sub_space.name %></td>
        <td><%= link_to fa_icon('times'), admin_space_delete_sub_space_path(space_id:@space.id, name:sub_space.name), method: :delete, action: :delete_sub_space,
                        data: { confirm: 'Are you sure you want to delete this sub space ?' } %></td>
      </tr>
    <% end %>
  </table>
    <br>


  <table class="table table-striped">
    <th class="destroy-header">Destroy Space</th>
  </table>
  <div>
    <span style="font-weight:bold;color:#E91D1D"> Destroying a space will erase all associated data including trainings, training sessions, and certifications.</span>
    <br></br>
    Type <span style="font-weight:bold;"><%= @space.name.upcase %></span> in the box then click DESTROY:
    <br>
    <%= form_for admin_spaces_path, action: :destroy, method: :delete do |f| %>
      <div class="mb-3">
        <%= text_field_tag :admin_input, "", class: "form-control" %>
      </div>
      <%= hidden_field_tag :id, @space.id %>
      <%= f.submit "DESTROY", class: "btn btn-danger", data: { confirm: 'Are your sure you want to completely DELETE this space and all related informaion?! Ok to confirm' } %>
    <% end %>
  </div>

  <br>
</section>
<%= javascript_pack_tag 'staff_availability', 'data-turbolinks-track': 'reload' %>
